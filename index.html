<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cute Quote Widget</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --ink:#1e2321;     /* quote text color */
    --accent:#365c49;  /* author color */
  }

  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{
    background:transparent;
    display:flex;align-items:center;justify-content:center;
    font-family:'Quicksand',sans-serif;color:var(--ink);
  }

  /* Your PNG size */
  .widget{
    position:relative;
    width: 550px;
    height: 300px;
    background:url('quote_widget.png') center/cover no-repeat;
    border-radius:18px;
  }

  /* Safe area inside the cream panel */
  .content{
    position:absolute;
    /* TUNE THESE if needed */
    top: 100px;        /* push below ‚ÄúMotivational Quote:‚Äù */
    right: 150px;      /* avoid right border/quotes */
    bottom: 52px;     /* avoid bottom border/shadow */
    left: 150px;       /* avoid left border/opening quotes */
  }

  .quote{
    margin:0;
    font-size: 40px;         /* will auto-shrink if needed */
    line-height:1.35;
    text-wrap:balance;
    overflow-wrap:anywhere;
    hyphens:auto;
  }

  /* Author anchored inside lower-right of the content box */
  .author{
    position:absolute;
    right: 2px;
    bottom: 6px;
    margin:0;
    font-size: 15px;
    color:var(--accent);
    white-space:nowrap;
    text-overflow:auto;
   
    max-width:60%;
  }
</style>
</head>
<body>
  <div class="widget">
    <div class="content" id="content">
      <div id="quote" class="quote">Loading‚Ä¶</div>
      <div id="author" class="author"></div>
    </div>
  </div>

<script>
/* CSV loader: Author,Quote */
async function loadQuotes(){
  const res = await fetch('quotes.csv',{cache:'no-store'});
  const txt = await res.text();
  const lines = txt.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
  if(!lines.length) return [];
  const first = lines[0].replace(/\s+/g,'').toLowerCase();
  const rows = (first==='author,quote') ? lines.slice(1) : lines;

  return rows.map(line=>{
    const cells=[]; let cur='', inQ=false;
    for(let i=0;i<line.length;i++){
      const ch=line[i], nx=line[i+1];
      if(ch==='\"' && nx==='\"'){ cur+='\"'; i++; continue; }
      if(ch==='\"'){ inQ=!inQ; continue; }
      if(ch===',' && !inQ){ cells.push(cur.trim()); cur=''; continue; }
      cur+=ch;
    }
    cells.push(cur.trim());
    const a=(cells[0]||'').replace(/^\"|\"$/g,'');
    const q=(cells[1]||'').replace(/^\"|\"$/g,'');
    return [q,a];
  });
}

/* Auto-fit quote into the content area */
function autoFit(el, container, {max=40, min=14, step=1, lines=5}={}){
  let size=max;
  el.style.fontSize=size+'px';
  el.style.lineHeight='1.35';
  el.style.display='';

  const fits=()=>(
    el.scrollHeight <= container.clientHeight*0.78 &&   // leave room for author
    el.scrollWidth  <= container.clientWidth*0.98
  );

  while(size>min && !fits()){
    size-=step;
    el.style.fontSize=size+'px';
  }

  if(!fits()){
    el.style.display='-webkit-box';
    el.style.webkitBoxOrient='vertical';
    el.style.webkitLineClamp=String(lines);
    el.style.overflow='hidden';
    el.title=el.textContent;
  }else{
    el.title='';
  }
}

function render(q,a){
  const qEl=document.getElementById('quote');
  const aEl=document.getElementById('author');
  const box=document.getElementById('content');
  qEl.textContent = q ? `‚Äú${q}‚Äù` : '';
  aEl.textContent = a ? `‚Äî ${a}` : '';
  autoFit(qEl, box, {max:40, min:14, lines:5});
}

(async function(){
  try{
    const list=await loadQuotes();
    if(!list.length){ document.getElementById('quote').textContent='No quotes found.'; return; }
    const i=Math.floor(Math.random()*list.length);  // random on load
    render(...list[i]);
  }catch(e){
    console.error(e);
    document.getElementById('quote').textContent='Error loading quotes üò¢';
  }
})();
</script>
</body>
</html>
